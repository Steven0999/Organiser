<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily Organiser with SortableJS & Undo</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap">
<style>
:root{--accent:#2563eb;--muted:#6b7280;--bg:#f7f9fc}
*{box-sizing:border-box}
body{font-family:Inter,system-ui,Arial;margin:0;background:var(--bg);color:#0b1220;-webkit-font-smoothing:antialiased}
.app{max-width:1000px;margin:22px auto;padding:18px;background:white;border-radius:12px;box-shadow:0 8px 30px rgba(15,23,42,.06)}
header{display:flex;align-items:center;gap:12px;margin-bottom:14px}
h1{font-size:20px;margin:0}
.pages{min-height:520px}
.page{display:none}
.page.active{display:block}
.controls{display:flex;justify-content:space-between;align-items:center;margin-top:18px}
button{background:var(--accent);color:white;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
button.ghost{background:transparent;color:var(--accent);border:1px solid #e6eefc}
input,select{padding:8px;border-radius:8px;border:1px solid #e6eefc}
.row{display:flex;gap:12px;align-items:center}
.small{font-size:13px;color:var(--muted)}
.task-form{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
.task-list{border-radius:8px;border:1px dashed #e6eefc;padding:10px;min-height:120px}
.task-item{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:8px;background:#fbfdff;margin-bottom:8px}
.task-meta{font-size:13px;color:var(--muted)}
.rank-grid,.rank-tasks,.inbox{border-radius:8px;border:1px solid #eef5ff;padding:10px;min-height:120px;background:#fff;overflow:auto}
.rank-tasks .draggable,.inbox .draggable{padding:8px;margin-bottom:8px;background:white;border-radius:8px;border:1px solid #e6eefc;cursor:grab}
.scheduler{display:flex;gap:18px}
.left{width:280px}
.current-task{padding:12px;border-radius:10px;border:1px solid #e6eefc;background:#fff;margin-bottom:10px}
.calendar{flex:1;border-radius:8px;border:1px solid #eef5ff;position:relative;padding:12px;height:420px;background:linear-gradient(180deg,#fff,#fbfdff);overflow:auto}
.slot{border-top:1px dashed #f1f6ff;height:40px;box-sizing:border-box;display:flex;align-items:center;padding-left:8px;position:relative}
.task-block{position:absolute;border-radius:8px;padding:6px;font-size:13px;color:#062a4b;background:rgba(37,99,235,.10);border:1px solid rgba(37,99,235,.18);cursor:grab;transition:0.2s}
.locked .draggable{cursor:default;opacity:.6}
.warning{color:#b44;margin-top:8px}
@media (max-width:900px){.scheduler{flex-direction:column}.left{width:100%}.calendar{height:360px}}
@media (max-width:520px){.task-form input{min-width:120px}}
</style>
</head>
<body>
<div class="app" id="app">
<header>
<h1>Daily Organiser</h1>
<div class="small">Add tasks → Rank → Set time → Schedule → Summary</div>
</header>
<div class="pages">
<section class="page active" id="page-tasks">
<h3>1) Add tasks</h3>
<div class="task-form">
<input id="task-name" placeholder="Task name" style="flex:1" />
<input id="task-duration" type="number" min="1" placeholder="Duration (mins)" style="width:140px" />
<button id="add-task">Add</button>
</div>
<div class="row">
<div style="flex:1">
<div class="small">Tasks</div>
<div class="task-list" id="task-list"></div>
</div>
<div style="width:220px">
<div class="small">Actions</div>
<div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
<button id="to-rank">Next: Rank tasks →</button>
<button id="clear-tasks" class="ghost">Clear tasks</button>
</div>
</div>
</div>
</section>
<section class="page" id="page-rank">
<h3>2) Rank tasks (drag to reorder)</h3>
<div style="display:flex;gap:12px;flex-wrap:wrap">
<div style="flex:1;min-width:260px">
<div class="small">Drag to reorder. Top = Priority 1</div>
<div style="margin-top:8px" id="rank-tasks" class="rank-tasks"></div>
</div>
</div>
<div class="controls">
<button id="back-to-tasks" class="ghost">← Back</button>
<button id="rank-to-time">Next: Set Awake Time →</button>
</div>
</section>
<section class="page" id="page-time">
<h3>3) Set awake period</h3>
<div style="display:flex;gap:10px;align-items:center">
<div class="small">Start</div>
<input id="awake-start" type="time" value="09:30" />
<div class="small">End</div>
<input id="awake-end" type="time" value="22:30" />
</div>
<div class="controls">
<button id="back-to-rank" class="ghost">← Back</button>
<button id="to-schedule">Next: Scheduler →</button>
</div>
</section>
<section class="page" id="page-scheduler">
<h3>4) Schedule your day</h3>
<div class="scheduler" id="scheduler-root">
<div class="left">
<div class="small">Current task</div>
<div class="current-task" id="current-task">No task selected</div>
<div style="display:flex;gap:8px;margin-bottom:8px"><button id="undo">Undo</button><button id="clear-scheduled" class="ghost">Clear all</button></div>
<div class="small">Remaining tasks</div>
<div class="inbox" id="inbox"></div>
<div id="sched-warning" class="warning"></div>
</div>
<div class="calendar" id="calendar">
<div class="time-grid" id="time-grid"></div>
</div>
</div>
<div class="controls">
<button id="back-to-time" class="ghost">← Back</button>
<button id="finish">Finish & Lock</button>
</div>
</section>
<section class="page" id="page-summary">
<h3>5) Summary</h3>
<div id="summary-list"></div>
<div class="controls">
<button id="reset" class="ghost">Reset</button>
<button id="export">Export JSON</button>
</div>
</section>
</div>
<footer>
<div class="small">Made with ❤️ — mobile-friendly</div>
</footer>
</div>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
const qs = s => document.querySelector(s);
const qsa = s => Array.from(document.querySelectorAll(s));
const state = {tasks:[],instances:[],schedule:[],locked:false,undoStack:[]};function uid(p='id'){return p+Math.random().toString(36).slice(2,9)} function minutesBetween(t1,t2){const [h1,m1]=t1.split(':').map(Number);const [h2,m2]=t2.split(':').map(Number);return (h260+m2)-(h160+m1)} function addMinutes(time,mins){const d=new Date();const [h,m]=time.split(':').map(Number);d.setHours(h);d.setMinutes(m+mins);return d.toTimeString().slice(0,5)}

function save(){localStorage.setItem('organiser_v2',JSON.stringify(state))} function load(){const v=localStorage.getItem('organiser_v2');if(v){Object.assign(state,JSON.parse(v))}}

function showPage(id){qsa('.page').forEach(p=>p.classList.remove('active'));qs(id).classList.add('active')}

// --- Tasks --- function renderTasks(){const list=qs('#task-list');list.innerHTML='';state.tasks.forEach(t=>{const el=document.createElement('div');el.className='task-item';el.innerHTML=<div><strong>${t.name}</strong><div class="task-meta">${t.duration} mins</div></div><div><button data-id='${t.id}' class='remove'>Delete</button></div>;list.appendChild(el);}); qsa('#task-list .remove').forEach(b=>b.onclick=()=>{state.tasks=state.tasks.filter(x=>x.id!==b.dataset.id);renderTasks();renderRanking();save()});}

qs('#add-task').addEventListener('click',()=>{const name=qs('#task-name').value.trim();const duration=Number(qs('#task-duration').value);if(!name||!duration) return alert('Provide name and duration');state.tasks.push({id:uid(),name,duration});qs('#task-name').value='';qs('#task-duration').value='';renderTasks();renderRanking();save()}); qs('#clear-tasks').addEventListener('click',()=>{if(confirm('Clear all tasks?')){state.tasks=[];state.instances=[];renderTasks();renderRanking();save()}})

// --- Ranking (Sortable) --- function renderRanking(){const list=qs('#rank-tasks');list.innerHTML='';state.tasks.forEach(t=>{const el=document.createElement('div');el.className='draggable';el.dataset.id=t.id;el.innerHTML=<strong>${t.name}</strong><div class='task-meta'>${t.duration} min</div>;list.appendChild(el);}); new Sortable(list,{animation:200,ghostClass:'sortable-ghost',onEnd:()=>{const ids=Array.from(list.children).map(e=>e.dataset.id);state.tasks=ids.map(id=>state.tasks.find(t=>t.id===id));save();}}); } qs('#to-rank').addEventListener('click',()=>{if(!state.tasks.length)return alert('Add tasks first');renderRanking();showPage('#page-rank')}); qs('#back-to-tasks').addEventListener('click',()=>showPage('#page-tasks')); qs('#rank-to-time').addEventListener('click',()=>showPage('#page-time')); qs('#back-to-rank').addEventListener('click',()=>showPage('#page-rank'));

// --- Time --- qs('#to-schedule').addEventListener('click',()=>{buildInstances();renderInbox();renderCalendar();showPage('#page-scheduler')}); qs('#back-to-time').addEventListener('click',()=>showPage('#page-time')); function buildInstances(){state.instances=state.tasks.map(t=>({iid:uid(),id:t.id,name:t.name,duration:t.duration}))}

// --- Scheduler Inbox (Sortable) --- function renderInbox(){const inbox=qs('#inbox');inbox.innerHTML='';const placed=new Set(state.schedule.map(s=>s.instanceId));state.instances.forEach(inst=>{if(!placed.has(inst.iid)){const el=document.createElement('div');el.className='draggable';el.dataset.iid=inst.iid;el.innerHTML=<strong>${inst.name}</strong><div class='task-meta'>${inst.duration} min</div>;inbox.appendChild(el);}}); new Sortable(inbox,{animation:200,ghostClass:'sortable-ghost',onEnd:()=>save()}); renderCurrentTask();} function getCurrentUnplaced(){const placed=new Set(state.schedule.map(s=>s.instanceId));return state.instances.find(inst=>!placed.has(inst.iid))||null} function renderCurrentTask(){const cur=getCurrentUnplaced();const el=qs('#current-task');if(!cur){el.innerHTML='All tasks placed.';el.style.opacity=0.7;return}el.style.opacity=1;el.innerHTML=<div style='font-weight:700'>${cur.name}</div><div class='small'>${cur.duration} min</div>;}

// --- Calendar --- const minutePx=40/30; function renderCalendar(){const grid=qs('#time-grid');grid.innerHTML='';const start=qs('#awake-start').value;const end=qs('#awake-end').value;const totalMin=minutesBetween(start,end);if(totalMin<=0){grid.innerHTML='<div class=warning>End time must be after start time</div>';return}const rows=Math.ceil(totalMin/30);for(let i=0;i<rows;i++){const s=document.createElement('div');s.className='slot';s.dataset.index=i;s.addEventListener('click',()=>placeCurrentAt(i*30));grid.appendChild(s);}state.schedule.forEach(b=>placeBlockElement(b,start));} function placeBlockElement(block,startTime){const grid=qs('#time-grid');const top=minutesBetween(startTime,block.start)minutePx;const height=block.durationminutePx;const el=document.createElement('div');el.className='task-block';el.style.top=top+'px';el.style.left='6px';el.style.right='6px';el.style.height=height+'px';el.innerHTML=<strong>${block.name}</strong><div class='task-meta'>${block.start} • ${block.duration} min</div>;el.addEventListener('click',()=>{if(state.locked)return;if(confirm('Remove this block?')){state.schedule=state.schedule.filter(x=>x.bid!==block.bid);state.undoStack.push({action:'remove',block});renderInbox();renderCalendar();save();}});grid.appendChild(el);} function placeCurrentAt(offset){const cur=getCurrentUnplaced();if(!cur)return;const st=addMinutes(qs('#awake-start').value,offset);const block={bid:uid(),instanceId:cur.iid,name:cur.name,duration:cur.duration,start:st};state.schedule.push(block);state.undoStack.push({action:'add',block});renderInbox();renderCalendar();save();}

// --- Undo / Clear --- qs('#undo').addEventListener('click',()=>{const last=state.undoStack.pop();if(!last)return alert('Nothing to undo');if(last.action==='add'){state.schedule=state.schedule.filter(b=>b.bid!==last.block.bid)}else if(last.action==='remove'){state.schedule.push(last.block)}renderInbox();renderCalendar();save();}); qs('#clear-scheduled').addEventListener('click',()=>{if(confirm('Clear all?')){state.schedule=[];state.undoStack=[];renderInbox();renderCalendar();save();}});

// --- Finish / Summary --- qs('#finish').addEventListener('click',()=>{state.locked=true;save();renderSummary();showPage('#page-summary')}); function renderSummary(){const el=qs('#summary-list');el.innerHTML='';const start=qs('#awake-start').value;state.schedule.sort((a,b)=>minutesBetween(start,a.start)-minutesBetween(start,b.start)).forEach(b=>{const div=document.createElement('div');div.style.padding='8px';div.style.borderBottom='1px solid #f1f6ff';div.innerHTML=<strong>${b.start} - ${addMinutes(b.start,b.duration)}</strong> ${b.name} • ${b.duration} min;el.appendChild(div);});} qs('#reset').addEventListener('click',()=>{localStorage.removeItem('organiser_v2');location.reload()}); qs('#export').addEventListener('click',()=>{const data=JSON.stringify(state);const blob=new Blob([data],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='organiser.json';a.click();});

// --- Init --- function init(){load();renderTasks();renderRanking();} init(); </script>

</body>
  </html>
